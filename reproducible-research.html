<!DOCTYPE html>
<html>
  <head>
    <title>Reproducible Research in R</title>
    <meta charset="utf-8">
    <meta name="author" content="School of Data" />
    <meta name="date" content="2019-02-01" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Reproducible Research in R
## Robert Mitchell + Lauren Steely
<html>
<div style="float:left">

</div>
<hr color='#EB811B' size=1px width=796px>
</html>
### School of Data
### 2019-02-01

---




# Follow along
&lt;br&gt;
### GitHub repository for slides + examples 
&lt;br&gt;
### `https://github.com/robertmitchellv/School-of-Data-RR`

---
class: inverse, center, middle

# Synopsis

So you've spent hours on a cool data analysis project; how do you share it with your colleagues, your stakeholders, or the public? And how do you ensure other analysts can reproduce what you've done?

---
class: inverse, center, middle

# First, let's take a step back, what is it exactly that we're trying to avoid?

---
class: inverse
background-image: url("images/spreadsheet-example.png")

---
class: inverse, center
background-image: url("images/spreadsheet-example.png")

# What's wrong with this picture?

---
# Do not use colored text or cell shading

&lt;br&gt;

This formatting is lost when the data are exported or the file is opened in another program. Consider adding another column where the information indicated by the coloring and shading can be included in text form.

---
# Do not use commas

&lt;br&gt;

When data are exported as a comma separated value (`.csv`) file, the commas within your data cells can cause confusion. They also sometimes indicate that multiple pieces of data (like city, state) are included in a single column. Separate data into multiple fields if appropriate or use another kind of separator (colon, semicolon -- but not a symbol!) if one is necessary. 

---
# Do not merge cells

&lt;br&gt;

Cell merging is typically lost when data are exported and is often misread by other software programs. This may result in the shifting of data cells in the affected rows or columns. In the case shown here, the cells in `column 1` should be unmerged and the date information entered into the first cell in each row.

---
class: inverse
background-image: url("images/merge-cell.jpg")

---
class: inverse, center, middle

# How do we avoid this?

---
class: inverse, center, middle

# REPRODUCIBILITY!

---
class: inverse, center, middle

# Great! How do I get there?

---
# The two levels of reproducibility

&lt;br&gt;

## ğŸ‘‰ The information organization / knowledge organization level

&lt;br&gt;

## ğŸ‘‰ The tooling that helps you accomplish the above

---
class: center, middle

## We'll split our time between the two levels--the conceptual thinking and how it is implemented practically leveraging tools in `R` ğŸ™Œ

---
class: inverse, center, middle

# Let's begin with a paradigm shift in coding that we've noticed

---
# Script vs Notebook

.pull-left[
### `R` Script

* Commenting code ğŸ‘‰
  + No way to distinguish text, limited formatting, dense
* All source, no presentation layer ğŸ‘‰
]

.pull-right[
### `Rmd` Document

* Mixture of markdown and code
  + Ability to format text, expand comments, document thinking, problems, worries, fears
* Source code, with presentation layer
]

---
# Script vs Notebook

.pull-left[
### `R` Script


```r
# comment explaining how 
# I'm using ISLR::Auto
# but assigning it to `auto` 
# while also using 
# janitor::clean_names()
auto %&gt;%
  lm(mpg ~ horsepower, data = .) %&gt;%
  tidy()
```
]

.pull-right[
### `Rmd` Document

__Linear Regression__

You can write the formula

$$ \hat{Y}=\hat{\beta}_0+\hat{\beta}_1X_1+\cdots+\hat{\beta}_pX_p $$

Talk about it more, about how the data is from `ISLR::Auto` and how you used `janitor::clean_names()` and assigned it to `auto &lt;- ...`


```r
auto %&gt;%
  lm(mpg ~ horsepower, data = .) %&gt;%
  tidy()
```
]

---
class: inverse, center, middle

# My take is that the notebook is _cathartic_, it can be one part computational powerhouse, one part diary, all parts documented and preserved--successes and failures.

---
# What is a code chunk?

&lt;br&gt;

The way that `Rmd` files work is that the `R` code you want to execute is placed within what is generally referred to as a __code chunk__. This is what one looks like:

&lt;pre class="markdown"&gt;&lt;code&gt;&amp;#96;&amp;#96;&amp;#96;{r}
# R code goes below

&amp;#96;&amp;#96;&amp;#96;
&lt;/code&gt;&lt;/pre&gt;

---
# Code chunks (continued)

&lt;br&gt;

Code chunks can also be named, with certain functionality turned on or off as well as other arguments changed. For example, to include a chunk but not execute it you would write:

&lt;pre class="markdown"&gt;&lt;code&gt;&amp;#96;&amp;#96;&amp;#96;{r eval=FALSE}
# R code goes below

&amp;#96;&amp;#96;&amp;#96;
&lt;/code&gt;&lt;/pre&gt;

&lt;br&gt;

To hide a chunk so it doesn't appear in your report, you would write:

&lt;pre class="markdown"&gt;&lt;code&gt;&amp;#96;&amp;#96;&amp;#96;{r include=FALSE}
# R code goes below

&amp;#96;&amp;#96;&amp;#96;
&lt;/code&gt;&lt;/pre&gt;

---
class: inverse, center, middle

# There are _many_ other customizations, but to keep things simple turning evaluation on or off and showing or hiding a code chunk will help you through a majority of reporting issues.

---
# Documenting an analysis

&lt;br&gt;

## Let's break into small groups and work on documenting a toy analysis with our neighbors

&lt;br&gt;

If you don't know what data you should use, you can use the `dplyr::starwars` data set or open this file in the `examples/starwars` directory on GitHub

```
â””â”€â”€ examples
    â””â”€â”€ starwars
*       â”œâ”€â”€ starwars-analysis.Rmd
        â””â”€â”€ starwars-analysis.nb.html
```

---
# Starwars Analysis

&lt;br&gt;

You can try opening this file to see what your notebook would look like; RStudio is taking the `Rmd` file and automatically creating this `html` file that you can use as a report

```
â””â”€â”€ examples
    â””â”€â”€ starwars
        â”œâ”€â”€ starwars-analysis.Rmd
*       â””â”€â”€ starwars-analysis.nb.html
```

---
# Starwars Analysis

&lt;br&gt;

The brilliant thing about the `.nb.html` file, is that this document can be shared with colleagues, stakeholders, your boss; anyone that needs to know what you've been able to demonstrate with the data.

&lt;br&gt;

You're already making good progress!

---
class: inverse, center, middle

# Anyone want to share some takeaways from this exercise?

---
# Naming conventions

&lt;br&gt;

There are many conventions and I would encourage you to think about your project and how best it could be organized.

&lt;br&gt;

There is no _canon_ here. Nevertheless, I can share some of the things that has worked in connection to data science projects to at least give you all an ğŸ’¡ of how you could approach naming and organizing.

---
# Main Directories (Folders)

I like the following main directories

```
â””â”€â”€ project-root
    â”œâ”€â”€ data
    â”œâ”€â”€ docs
    â”œâ”€â”€ models
    â”œâ”€â”€ notebooks
    â””â”€â”€ reports
```

---
# Main Directories (Folders)

&lt;br&gt;

* `data` is where all data and metadata is stored
* `docs` is where all text documents _about_ the project are stored
* `models` is where you can save the models you are developing, building, and deploying
* `notebooks` is where you can put your `Rmd` files
* `reports` is for all the things that are written from `Rmd` into another format, e.g., `xlsx`, `png`, et cetera

---
# Closer look: 'data' directory

&lt;br&gt;

The `data` directory should have the following sub-directories

```
â””â”€â”€ data
    â”œâ”€â”€ external
    â”œâ”€â”€ raw
    â”œâ”€â”€ interim
    â””â”€â”€ tidy
```

---
# Closer look: 'data' directory

&lt;br&gt;

You don't need to over-complicate your project with so many granular levels for your data, but here is an example, the two most important directories are highlighted.

```
â””â”€â”€ data
    â”œâ”€â”€ external
*   â”œâ”€â”€ raw
    â”œâ”€â”€ interim
*   â””â”€â”€ tidy
```

---
# Closer look: 'docs' directory

&lt;br&gt;

This is a great chance to add any information that is associated with the project in any useful way. References is not the most exciting name, but it's important to have a place to put footnotes that reference other documents someplace. Other names could be `exhibits`, et cetera.

```
â””â”€â”€ docs
    â””â”€â”€ references
```

---
# Closer look: `reports` directory

&lt;br&gt;

I like to keep visualization files (`png` or `jpg`) in `figures`, however, you can decide what you feel is best.

```
â””â”€â”€ reports
    â””â”€â”€ figures
```

---
# Naming your notebooks

&lt;br&gt;

I like to think of notebooks in a functional way, i.e., that the notebook has a specific goal to achieve and that it shouldn't try to do too much. To illustrate, here's an example of what I mean:

```
â””â”€â”€ notebooks
    â”œâ”€â”€ 00-read-and-join-data.Rmd
    â”œâ”€â”€ 01-tidy-and-write-interim.Rmd
    â”œâ”€â”€ 02-transform-and-write-tidy.Rmd
    â”œâ”€â”€ 03-model-preprocess.Rmd
    â”œâ”€â”€ 04-model-fit.Rmd   
    â””â”€â”€ 05-model-results-performance.Rmd
```

---
class: inverse, center, middle

# Numbering the notebooks and giving them specific jobs to do helps you stay organized in your code and ensures that the pieces of your workflow follow a logical order.

---
# Naming your notebooks

&lt;br&gt;

You can dial up or down the granularity by including an additional level of directories depending on your project. For example:

```
â””â”€â”€ notebooks
    â”œâ”€â”€ project-a 
    â”‚   â”œâ”€â”€ 00-read-and-join-data.Rmd
    â”‚   â”œâ”€â”€ 01-tidy-and-write-interim.Rmd
    â”‚   â”œâ”€â”€ 02-transform-and-write-tidy.Rmd
    â”‚   â”œâ”€â”€ 03-model-preprocess.Rmd
    â”‚   â”œâ”€â”€ 04-model-fit.Rmd   
    â”‚   â””â”€â”€ 05-model-results-performance.Rmd
    â””â”€â”€ project-b
        â”œâ”€â”€ 00-read-and-join-geo-data.Rmd
        â”œâ”€â”€ 01-build-test-leaflet-maps.Rmd
        â””â”€â”€ 02-present-geo-analysis-results.Rmd
```

---
class: inverse, center, middle

# It's up to you how much nested structure you want to include into your project--complexity runs the risk of, on the one hand, being more precise; and, on the other hand, being too difficult to understand. Reproducibility is about striking that balance.

---
# Let's move into the second level

&lt;br&gt;

### Now that we've had a chance to tackle some of the ways we can _think_ about the structure of our project, let's move on to the tools you can use to accomplish this more easily!

---
# Project creation

&lt;br&gt;

.pull-left[
`usethis`
]

.pull-right[
(https://github.com/r-lib/usethis)
]

A fantastic `R` package to help you quickly build new projects once you've done your thinking about how you want them set up.

---
# GitHub ignores

&lt;br&gt;

Quickly set up your `.gitignore` file


```r
library(usethis)

# Files for git to ignore
#  'scratch_*.*' means that anything you name with 'scratch_' first will be
#  ignored so you don't commit and push your random notes/bug fixes
ignores &lt;- c(
  ".Rhistory", ".RData", ".Rproj.user",
  "scratch_*.*", ".DS_Store"
)
```

---
# Create the project

&lt;br&gt;


```r
# Create project using the current working directory
#  It was necessary to open create_project.R in RStudio for an .Rproj file
#  to be successfully created. Also 'use_description()' will only work if
#  the project name meets the same criteria as a package name, so the '-'
#  messed things up--without a 'DESCRIPTION' file, the 'use_gpl3_license()'
#  won't work.
create_project(path = getwd())
use_description()
use_git_ignore(ignores = ignores)
use_gpl3_license(name = "Robert Mitchell")
```

---
# Create project directories

&lt;br&gt;

Now you can create the project directories we talked about earlier.


```r
# Create project directories
use_directory("data")
use_directory("docs")
use_directory("models")
use_directory("notebooks")
use_directory("reports")

# Create project subdirectories
use_directory("data/external")
use_directory("data/raw")
use_directory("data/interim")
use_directory("data/tidy")
use_directory("docs/references")
use_directory("reports/figures")
```

---
class: inverse, center, middle

# Try to set up your own script with the 'usethis' package!

---
# Choose your own adventure

&lt;br&gt;

You can _usethis_ example ğŸ˜…

```
â””â”€â”€ examples
    â””â”€â”€ usethis
*       â””â”€â”€ create_project.R
```

---
class: inverse, center, middle

# Any thoughts on the exercise?

---
# Taking your notebooks to the next level

&lt;br&gt;

One of the amazing things that `Rmd` documents can do is easily be connected together and hosted online. __YES__, you can create a website with `rmarkdown` ğŸ‰

---
# Shameless self promotion

&lt;br&gt;

I created my website with `rmarkdown` so you can see both an example of what it looks like and play with the code I used to see how it works

* `robertmitchellv.com`

* `https://github.com/robertmitchellv/robertmitchellv.github.io`

---
# Creating websites

&lt;br&gt;

The documentation for doing this is really good; you should consult it if you want to dive into this area

* `https://rmarkdown.rstudio.com/lesson-13.html`

* I also have a blog post about it as well:
`http://robertmitchellv.com/blog-building-site-with-rmarkdown.html`

---
class: inverse, center, middle

# Let's look at a simpler example of how to do this that also takes highlights how powerful notebooks are

---
# ISLR notes

&lt;br&gt;

Start by navigating to the `Index.html` file and openning it

```
â””â”€â”€ examples
    â””â”€â”€ islr
        â”œâ”€â”€ 01-introduction.Rmd
        â”œâ”€â”€ 01-introduction.html
        â”œâ”€â”€ 02-statistical-learning.Rmd
        â”œâ”€â”€ 02-statistical-learning.html
        â”œâ”€â”€ 03-linear-regression.Rmd
        â”œâ”€â”€ 03-linear-regression.html
        â”œâ”€â”€ 04-classification.Rmd
        â”œâ”€â”€ 04-classification.html
        â”œâ”€â”€ 04-classification_files
        â”œâ”€â”€ Index.Rmd
*       â”œâ”€â”€ Index.html
        â”œâ”€â”€ README.md
        â”œâ”€â”€ _site.yml
        â”œâ”€â”€ data
        â””â”€â”€ style.css
```

---
class: inverse, center, middle

# How does this work? ğŸ¤”

---
# Linking notes together

The important file here is the `_site.yml`, which contains the following important settings--the `href:` section is what links the `Rmd` files together.


```yaml
name: "ISLR Notes"
output_dir: "."
navbar:
  title: "ISLR Notes"
  left:
    - text: "Chapter Notes"
      icon: fa-line-chart
      menu:
        - text: "Chapter 1"
          icon: fa-code
*         href: 01-introduction.html
        - text: "Chapter 2"
          icon: fa-code
*         href: 02-statistical-learning.html
        - text: "Chapter 3"
          icon: fa-code
*         href: 03-linear-regression.html
  right:
    - icon: fa-book fa-lg
      href: http://www-bcf.usc.edu/~gareth/ISL/
output:
  html_document:
    theme: yeti
    css: style.css
```

---
# Creating pseudo-interactive dashboards

&lt;br&gt;

Start by navigating to the `water-dashboard` example

```
â””â”€â”€ examples
    â””â”€â”€ water-dashboard
*       â””â”€â”€ Water_Dashboard_-_for_SoD.html
```

This is an `Rmd` based dashboard Lauren created

---
# Dip your toes into dashboards

&lt;br&gt;

See all the examples here:
`https://rmarkdown.rstudio.com/flexdashboard/examples.html`

There is a blank `flexdashboard` you can play with 

```
â””â”€â”€ examples
    â””â”€â”€ flexdashboard
*       â””â”€â”€ blank.Rmd
```

---
class: inverse, center, middle

# Questions?

---
class: inverse, center, middle

# Thank you! ğŸ™
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
